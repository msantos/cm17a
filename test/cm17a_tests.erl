-module(cm17a_tests).

-compile(export_all).

-include_lib("eunit/include/eunit.hrl").

encode_test() ->
    ?assertEqual(<<213,170,80,40,173>>, cm17a:encode($D, 3, off)).

insn_test() ->
    Arch = erlang:system_info(system_architecture),
    [Proc,_,OS,_] = re:split(Arch, "-", [{return,binary}]),

    Insn = case {Proc,OS} of
        {<<"armv7l">>,<<"linux">>} ->
            [{21526,6,350}, {21527,2,1}, {21526,6,0}, {21527,2,1}, {21526,6,0},
             {21527,4,1}, {21526,6,0}, {21527,2,1}, {21526,6,0}, {21527,4,1},
             {21526,6,0}, {21527,2,1}, {21526,6,0}, {21527,4,1}, {21526,6,0},
             {21527,2,1}, {21526,6,0}, {21527,2,1}, {21526,6,0}, {21527,4,1},
             {21526,6,0}, {21527,2,1}, {21526,6,0}, {21527,4,1}, {21526,6,0},
             {21527,2,1}, {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,2,1},
             {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,4,1}, {21526,6,0},
             {21527,2,1}, {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,2,1},
             {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,4,1}, {21526,6,0},
             {21527,4,1}, {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,4,1},
             {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,2,1}, {21526,6,0},
             {21527,4,1}, {21526,6,0}, {21527,2,1}, {21526,6,0}, {21527,4,1},
             {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,4,1}, {21526,6,0},
             {21527,2,1}, {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,2,1},
             {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,2,1}, {21526,6,0},
             {21527,2,1}, {21526,6,0}, {21527,4,1}, {21526,6,0}, {21527,2,1},
             {21526,6,0}, {21526,6,350}];
        _ ->
            []
    end,

    case Insn of
        [] -> ok;
        _ -> ?assertEqual(Insn, cm17a:insn(<<213,170,80,40,173>>))
    end.
